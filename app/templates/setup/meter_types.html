<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zählertypen einrichten</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/setup.css') }}">
</head>
<body>
    <div class="setup-shell">
        <div class="setup-card">
            <div class="setup-header">
                <span class="setup-badge">Schritt 4 von 4</span>
                <h1 class="setup-title">Standard-Zählertypen</h1>
                <p class="setup-subtitle">Wir legen die gängigen Zählertypen automatisch für dich an.</p>
            </div>

            <ul class="setup-list">
                <li><span>✅</span><span>Strom & Allgemeinstrom</span></li>
                <li><span>✅</span><span>Wasser, Heizung und Gas</span></li>
                <li><span>✅</span><span>Wärmepumpe, Wallbox, PV-Einspeisung</span></li>
            </ul>

            <form id="meterTypesForm" class="form-footer setup-actions">
                <a href="{{ url_for('setup.setup_apartment') }}" class="setup-btn secondary">Zurück</a>
                <button type="submit" class="setup-btn">Zählertypen anlegen</button>
            </form>

            <div id="meterMessage" class="setup-info" style="display:none;"></div>
        </div>
    </div>

    <script>
        const meterForm = document.getElementById('meterTypesForm');
        const meterMessage = document.getElementById('meterMessage');

        meterForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = meterForm.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Lege an...';

            try {
                const response = await fetch('/setup/meter-types', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                const result = await response.json();
                if (result.success) {
                    window.location.href = '/setup/complete';
                } else {
                    throw new Error(result.message || 'Unbekannter Fehler');
                }
            } catch (error) {
                meterMessage.style.display = 'block';
                meterMessage.textContent = 'Fehler: ' + error.message;
                meterMessage.style.borderColor = '#e74c3c';
                meterMessage.style.background = '#fdecea';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Zählertypen anlegen';
            }
        });
    </script>
</body>
</html>
