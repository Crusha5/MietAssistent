<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="static/css/contract_pdf.css">
</head>
<body class="contract-body">
    <h1 class="main-title">Protokoll {{ protocol.protocol_type|replace('ueber','Über')|replace('rueck','Rück') }}</h1>
    <section class="meta-grid">
        <div>
            <div class="label">Datum</div>
            <div class="value">{{ protocol.protocol_date.strftime('%d.%m.%Y') }}</div>
        </div>
        {% if contract %}
        <div>
            <div class="label">Vertrag</div>
            <div class="value">{{ contract.contract_number }}</div>
        </div>
        {% endif %}
        <div>
            <div class="label">Typ</div>
            <div class="value">{{ protocol.protocol_type }}</div>
        </div>
    </section>
    <div class="divider"></div>

    <section class="clause">
        <div class="clause-title">Zustand / Räume</div>
        <div class="info-box box-large">{{ protocol_data.condition_summary or '' }}</div>
    </section>

    <section class="clause">
        <div class="clause-title">Schlüssel (gesamt {{ protocol_data.key_count or (keys|length) or 0 }})</div>
        {% if keys %}
        <div class="key-grid">
            {% for key in keys %}
            <div class="key-card">
                <div class="key-title">
                    <span>{{ key.title or 'Schlüssel ' ~ loop.index }}</span>
                    <span class="key-qty">{{ key.quantity or 1 }}×</span>
                </div>
                <div class="key-meta">{{ key.location or '—' }}</div>
                {% if key.description %}<div class="key-notes">{{ key.description }}</div>{% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="info-box">Keine Schlüsselangaben hinterlegt.</div>
        {% endif %}
    </section>

    <section class="clause">
        <div class="clause-title">Inventar / Ausstattung</div>
        {% if inventory_entries %}
        <table class="table">
            <thead>
                <tr>
                    <th>Bezeichnung</th>
                    <th>Raum</th>
                    <th>Zustand</th>
                    <th>Menge</th>
                    <th>Schäden / Notizen</th>
                </tr>
            </thead>
            <tbody>
                {% for item in inventory_entries %}
                <tr>
                    <td>{{ item.name }}</td>
                    <td>{{ item.location or '' }}</td>
                    <td>{{ item.condition or '' }}</td>
                    <td style="text-align:right;">{{ item.quantity or 1 }}</td>
                    <td>
                        <div style="color:#b91c1c;">{{ item.damages or '' }}</div>
                        <div class="value">{{ item.notes or '' }}</div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="info-box">Keine Inventardaten hinterlegt.</div>
        {% endif %}
    </section>

    <section class="clause">
        <div class="clause-title">Zählerstände</div>
        {% if meter_entries %}
        <table class="table">
            <thead>
                <tr>
                    <th>Typ</th>
                    <th>Nummer</th>
                    <th>Ort</th>
                    <th>Wert</th>
                    <th>Foto</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in meter_entries %}
                <tr>
                    <td>{{ entry.type }} {{ '(' ~ entry.unit ~ ')' if entry.unit }}</td>
                    <td>{{ entry.number }}</td>
                    <td>{{ entry.location or '' }}</td>
                    <td>{{ entry.reading_value or '' }}</td>
                    <td>{{ 'Foto hinterlegt' if entry.photo else '' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="info-box">Keine Zählerstände erfasst.</div>
        {% endif %}
    </section>

    <section class="clause">
        <div class="clause-title">Zählerstände / Hinweise</div>
        <div class="info-box box-large">{{ protocol_data.meter_notes or '' }}</div>
    </section>
    <section class="clause">
        <div class="clause-title">Raum- / Checklisten-Notizen</div>
        <div class="info-box box-large">{{ protocol_data.room_notes or '' }}</div>
    </section>
    <section class="clause">
        <div class="clause-title">Schäden / Beanstandungen</div>
        <div class="info-box box-large">{{ protocol_data.damages or '' }}</div>
    </section>
    <section class="clause">
        <div class="clause-title">Abweichungen / Rücknahme</div>
        <div class="info-box box-large">{{ protocol_data.return_notes or '' }}</div>
    </section>
    <section class="clause">
        <div class="clause-title">Notizen</div>
        <div class="info-box box-large">{{ protocol_data.notes or '' }}</div>
    </section>
    <section class="clause">
        <div class="clause-title">Übergabevermerke</div>
        <div class="info-box box-large">{{ protocol_data.handover_notes or '' }}</div>
    </section>
    <section class="clause">
        <div class="clause-title">Nacharbeiten / To-dos</div>
        <div class="info-box box-large">{{ protocol_data.follow_up_notes or '' }}</div>
    </section>
    <section class="clause">
        <div class="clause-title">Einverständniserklärung</div>
        <div class="legal-box">
            Mit den oben dokumentierten Zuständen, Zählerständen und übergebenen bzw. zurückgenommenen Gegenständen sind beide Parteien einverstanden. Abweichungen wurden festgehalten. Änderungen nach Unterzeichnung bedürfen einer gesonderten schriftlichen Vereinbarung.
        </div>
        <div class="signature-meta">
            <div>Ort: ____________________________________</div>
            <div>Datum: __________________________________</div>
        </div>
        <div class="signature-row">
            <div class="sig-cell">
                <div class="sig-line"></div>
                <div class="sig-label">Vermieter / Verwaltung</div>
            </div>
            <div class="sig-cell">
                <div class="sig-line"></div>
                <div class="sig-label">Mieter / Mietende</div>
            </div>
        </div>
    </section>
</body>
</html>
